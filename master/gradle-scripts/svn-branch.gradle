import groovy.sql.Sql

ext {
    // ブランチ名
    branchName = getBranchName()
}

// ローカルのSVN DBファイルからブランチ名を取得
def getBranchName() {

    def snvDbFile = file('.svn/wc.db')

    // SVN DBファイルがない場合、プロパティファイルの設定値を返す
    if (!snvDbFile.exists()) { return project.ext.branchName }

    def sql = Sql.newInstance("jdbc:sqlite:${snvDbFile.path}", 'org.sqlite.JDBC')
    def branchName = ''

    sql.eachRow("select * from NODES where local_relpath = ''") {

        branchName = it.repos_path.split('/')[1]
    }

    return branchName
}
